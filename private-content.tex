\documentclass[a4paper,11pt]{article}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}

% Permit straight quotes, combined with upquote=true in lstset.
\usepackage{textcomp}

% Permit breaklines for code
\usepackage{listings}
\lstset{
 basicstyle=\ttfamily,
 columns=flexible,
 breaklines=true,
 upquote=true
}

% Use Times font
\usepackage[osf]{mathpazo}

% Define a custom color for hyperlinks
\usepackage[svgnames]{xcolor}
\definecolor{wpblue}{RGB}{34,92,173}
\definecolor{wpred}{RGB}{173,34,49}


% Define options for hyperlinks
\usepackage[colorlinks]{hyperref}
\hypersetup{
    colorlinks=true,
    anchorcolor=blue,
    citecolor=blue,
    filecolor=blue,
    linkcolor=wpblue,
    urlcolor=wpred,
}

\usepackage{booktabs}


\begin{document}

\title{Private Content plugin}
\author{\textsc{aldo latino}}
\date{Published on January 4, 2020}

\maketitle

\begin{abstract}
\noindent Private Content is a plugin for WordPress that displays a portion of a post/page content only to users of a specific role or to a single or multiple users. This file, written in \LaTeX, contains the \texttt{readme.md} file bundled with the plugin, with some adaptations. This document is released under the same terms of the plugin's license.
\end{abstract}

\newpage

\tableofcontents

\newpage

\section{Introduction}

The plugin is developed using \href{https://github.com/aldolat/private-content}{GitHub}\footnote{\texttt{https://github.com/aldolat/private-content}.} and it can be downloaded from the \href{https://wordpress.org/plugins/private-content}{WordPress official repository}\footnote{\texttt{https://wordpress.org/plugins/private-content}.}.

The author can be contacted via email at \href{mailto:aldolat@gmail.com}{\texttt{aldolat@gmail.com}}.

The plugin is released under the terms of the GPL License v3.0 and later:

\begin{quote}
Copyright \textcircled{c} 2009, 2020  Aldo Latino  (email : aldolat@gmail.com)
This program is free software: you can redistribute it and/or modify
it under the terms of the \textsc{gnu} General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but \textsc{without any warranty}; without even the implied warranty of
\textsc{merchantability} or \textsc{fitness for a particular purpose}.  See the
\textsc{gnu} General Public License for more details.

You should have received a copy of the \textsc{gnu} General Public License
along with this program. If not, see\newline\href{http://www.gnu.org/licenses/}{http://www.gnu.org/licenses/}.
\end{quote}

\section{Description}

This plugin provides a shortcode to display a portion of a post or page content only to users of a specific role. For example, you can show the hidden text to Editors or to Authors or to any other WordPress role.

The action is performed using a shortcode, for example:

\begin{lstlisting}
[private role="administrator"]Text for administrators[/private]
\end{lstlisting}

Please, note that an Administrator can read an Editor private content or a Subscriber private content, and so on. Same thing for Editor, Author, Contributor, and Subscriber: \textit{a higher role can read a lower role content} (in almost all cases, see the paragraph below \textit{\hyperref[multiple-custom-roles]{Multiple custom roles}}), according to the following WordPress roles schema in descending order:

\begin{itemize}
 \item Administrator
 \item Editor
 \item Author
 \item Contributor
 \item Subscriber
\end{itemize}

Also you can show the hidden text \textit{only} to a certain role. For example, you can mark a text as visible only to Contributors and hide it to higher roles, such as Administrators or Editors and so on.

\section{Rapid changelog of the main modifications}

\begin{description}
 \item \textit{Version 3.0:} you can mark a text as visible only to a certain user, using his login name.
 \item \textit{Version 4.0:} you can mark a text as visible to multiple users, using their login names comma separated.
 \item \textit{Version 4.3:} you can use either the usual \verb+private+ shortcode or the extra \verb+ubn_private+, in case the first is already in use.
 \item \textit{Version 5.0:} you can use the new option \verb+reverse+ to change the logic of the \verb+recipient+ option. If \verb+reverse+ is activated, it will not allow users in \verb+recipient+ read the private note.
 \item \textit{Version 6.0}: you can use custom roles.
 \item \textit{Version 6.1:} you can use multiple custom roles. Also Administrators can always read text for custom roles, unless a \verb+role="custom-only"+ option has been used.
 \item \textit{Version 6.2:} you can use custom \textsc{id}s and/or classes for the \textsc{html} container.
\end{description}

\section{The shortcode command}

The shortcode is [\verb+private+]:

\begin{lstlisting}
[private {options}]Text[/private]
\end{lstlisting}

There is another shortcode available [\verb+ubn_private+], that can be used just in case \verb+private+ is already taken by another plugin:

\begin{lstlisting}
[ubn_private {options}]Text[/private]
\end{lstlisting}

\section{The shortcode options}

\subsection{Available options for the shortcode}

These are the available options for the shortcode, that will be explained in the next sections of this page:

\begin{itemize}
 \item \verb+role+
 \item \verb+custom_role+
 \item \verb+recipient+
 \item \verb+reverse+
 \item \verb+align+
 \item \verb+alt+
 \item \verb+container+
 \item \verb+id+
 \item \verb+class+
\end{itemize}

\subsection{[role] Display a text portion to a certain role}

Accepted arguments:

\begin{itemize}
 \item \verb+administrator+
 \item \verb+editor+
 \item \verb+editor-only+
 \item \verb+author+
 \item \verb+author-only+
 \item \verb+contributor+
 \item \verb+contributor-only+
 \item \verb+subscriber+
 \item \verb+subscriber-only+
 \item \verb+visitor+ or \verb+visitor-only+ (they are equivalent)
 \item \verb+none+
 \item \verb+custom+
 \item \verb+custom-only+
\end{itemize}

Let's see them in detail in the Table \ref{table:roles}.

\begin{table}
 \centering
 \begin{tabular}[t]{l p{7cm}}
 \toprule
 \textsc{Role} & \textsc{Result} \\
 \midrule
 \verb+administrator+ & The hidden text is shown to Administrators. \\
 \verb+editor+ & The hidden text is shown to Editors and Administrators. \\
 \verb+editor-only+ & The hidden text is shown to Editors only. \\
 \verb+author+ & The hidden text is shown to Authors, Editors, Administrators. \\
 \verb+author-only+ & The hidden text is shown to Authors only. \\
 \verb+contributor+ & The hidden text is shown to Contributors, Authors, Editors, Administrators. \\
 \verb+contributor-only+ & The hidden text is shown to Contributors only. \\
 \verb+subscriber+ & The hidden text is shown to Subscribers, Contributors, Authors, Editors, Administrators. \\
 \verb+subscriber-only+ & The hidden text is shown to Subscribers only. \\
 \verb+visitor+ / \verb+visitor-only+ & The hidden text is shown only to non-logged-in users. \textit{Administrators can read the hidden text.} \\
 \verb+none+ & When used, it is mandatory to use also the \verb+recipient+ option. The hidden text is shown only to users in the \verb+recipient+ list. \textit{Administrators cannot read the hidden text.} \\
 \verb+custom+ & When used, it is mandatory to use also the \verb+custom_role+ option. The hidden text is shown only to users that have a role in the \verb+custom_role+ list. \textit{Administrators can read the hidden text.} \\
 \verb+custom-only+ & When used, it is mandatory to use also the \verb+custom_role+ option. The hidden text is shown only to users that have a role in the \verb+custom_role+ list. \textit{Administrators cannot read the hidden text.} \\
 \bottomrule
 \end{tabular}
 \caption{Who can read the private text when a given role is used.}
 \label{table:roles}
\end{table}

\subsubsection{Examples}

Display this text to Administrators:

\begin{lstlisting}
[private role="administrator"]Text for Administrators[/private]
\end{lstlisting}

Display this text to Administrators and Editors:

\begin{lstlisting}
[private role="editor"]Text for Editors[/private]
\end{lstlisting}

Display this text to Administrators, Editors, and Authors:

\begin{lstlisting}
[private role="author"]Text for Authors[/private]
\end{lstlisting}

Display this text to Administrators, Editors, Authors, and Contributors:

\begin{lstlisting}
[private role="contributor"]Text for Contributor[/private]
\end{lstlisting}

Display this text to Administrators, Editors, Authors, Contributors, and Subscribers:

\begin{lstlisting}
[private role="subscriber"]Text for Subscribers[/private]
\end{lstlisting}

\subsubsection{Text only for specific roles excluding other roles}

If you want to show a note only to a certain role, you have to use a \verb+{role}-only+ option. In this way, for example, an Administrator or an Editor (roles higher than Author) cannot read a note for Authors only. These are all the cases: \newline

Display this text to Editors only:

\begin{lstlisting}
[private role="editor-only"]Text for Editors only[/private]
\end{lstlisting}

Display this text to Authors only:

\begin{lstlisting}
[private role="author-only"]Text for Authors only[/private]
\end{lstlisting}

Display this text to Contributors only:

\begin{lstlisting}
[private role="contributor-only"]Text for Contributors only[/private]
\end{lstlisting}

Display this text to Subscribers only:

\begin{lstlisting}
[private role="subscriber-only"]Text for Subscribers only[/private]
\end{lstlisting}

Display this text to Visitors only:

\begin{lstlisting}
[private role="visitor-only"]Text for Visitors only[/private]
\end{lstlisting}

or the equivalent shortcode:

\begin{lstlisting}
[private role="visitor"]Text for Visitors only[/private]
\end{lstlisting}

Display this text to Designers only (Designers is a custom role created by the user):

\begin{lstlisting}
[private role="custom-only" custom_role="designers"]Text for Designers only[/private]
\end{lstlisting}

\subsubsection{[recipient] Text only for a specific user or multiple users}

Accepted arguments:

\begin{itemize}
 \item login name of the target user. You can use multiple login names, comma separated.
\end{itemize}

In the case you want to show a text only to a specific user, assign \verb+none+ to \verb+role+ and a login name to \verb+recipient+:

\begin{lstlisting}
[private role="none" recipient="login-name"]Text for a specific user only[/private]
\end{lstlisting}

Change \verb+login-name+ with the correct login name of the target user.

You can use a comma separated list of usernames to target certain users:

\begin{lstlisting}
[private role="none" recipient="login-name1, login-name2, login-name3"]Text for specific users only[/private]
\end{lstlisting}

Change \verb+login-name1+, \verb+login-name2+, and \verb+login-name3+ with the correct login names of the target users.

\subsubsection{[custom\_role] Display a text portion to a custom role or multiple roles}

Accepted arguments:

\begin{itemize}
 \item the custom role
 \item the custom roles, comma separated
\end{itemize}

\paragraph{Single custom role}

If you want to show a text only to users of a custom role, use the option \verb+custom_role+.

For example:

\begin{lstlisting}
[private role="custom" custom_role="designers"]Text for Designers group.[/private]
\end{lstlisting}


Please, note that texts for custom roles can be read also by Administrators. To avoid this, use the \verb+role="custom-only"+ option, followed by the name of the custom role.

For example:

\begin{lstlisting}
[private role="custom-only" custom_role="designers"]Text for Designers only.[/private]
\end{lstlisting}


The option \verb+role=custom+ can be used also for the WordPress standard roles, for example:

\begin{lstlisting}
[private role="custom" custom_role="author"]Text for role Author.[/private]
\end{lstlisting}

In this case, Authors will read the private text, but higher roles (such as Editors) will not read it. It is like using a role-only option. Anyway, Administrators will read it. For more information, see the paragraph below \textit{\hyperref[multiple-custom-roles]{Multiple custom roles}}.

\paragraph{Multiple custom roles}\label{multiple-custom-roles}

If you want to show a text to multiple roles, you can enter them separated by a comma. For example:

\begin{lstlisting}
[private role="custom" custom_role="designers,engineers"]Text for Designers and Engineers groups.[/private]
\end{lstlisting}

You can mix custom roles and standard WordPress roles, with \hyperref[caveat]{a caveat}.

For example:

\begin{lstlisting}
[private role="custom" custom_role="designers,engineers,author"]Text for Designers, Engineers, and Authors group.[/private]
\end{lstlisting}

As you can see, Designers and Engineers are custom roles, while Author is a standard WordPress role. In the above example, Administrator will read the private text. Even in this case, as wrote before, you can use the \verb+role="custom-only"+ option to avoid Administrators can read the private text:

\begin{lstlisting}
[private role="custom-only" custom_role="designers,engineers,author"]Text for Designers, Engineers, and Authors group.[/private]
\end{lstlisting}

\subparagraph{Caveat} \label{caveat}

A note about using standard WordPress roles with \verb+role=custom+ option.

If you use a standard WordPress role with the \verb+custom_role+ option, you expect that a higher role can read the private text for lowers roles, i.e. a text for Author role should be read by Editor role (which is a role higher that Author). Actually, Editor role won't read that text. This is normal, because the option \verb+role="custom"+ follows a path different than standard WordPress role management. It's like you'd use a \verb+role-only+ option, in our example a \verb+role="author-only"+ option. For example, this shortcode:

\begin{lstlisting}
[private role="custom" custom_role="designers,engineers,author"]Text for Designers, Engineers, and Authors group.[/private]
\end{lstlisting}

will be read by Designers, Engineers, Authors, and Administrators, but not by Editors (even if Editors is a higher role that Author).

\subsection{[reverse] Reverse the logic of hiding text}

Accepted arguments:

\begin{itemize}
 \item \verb+1+ - Activate the reverse option
\end{itemize}


The option \verb+reverse=1+ is used when you want to hide a private text to some users or to some custom roles. Since it would be uncomfortable to add a lot of users/group in the shortcode, it is more convenient to tell the plugin to show the private text to all users/groups and hide it to some.

The \verb+reverse+ option is available only with the following options:

\begin{itemize}
 \item single users: \verb+role=none+, adding also the \verb+recipient+ option and the \verb+reverse+;
 \item custom roles: \verb+role=custom+, adding also the \verb+custom_role+ option and the \verb+reverse+.
\end{itemize}

See here below the two cases.

\subsubsection{Use of the "reverse" option for single users}

If you want to show a text to all users but not to some, activate the option \verb+reverse+, so that users added in the \verb+recipient+ option will not read the note.

For example:

\begin{lstlisting}
[private role="none" recipient="alice,bob,charlie" reverse=1]We all read this message while Alice, Bob, and Charlie can't read it![/private]
\end{lstlisting}

This shortcode will show the text to all users, excluding Alice, Bob, and Charlie (which cannot read the text).

\subsubsection{Use of the "reverse" option for roles}

You can use the \verb+reverse+ option also when using roles. In this case you will not use the \verb+recipient+ option, but simply in this way:

\begin{lstlisting}
[private role="custom" custom_role="designers" reverse=1]Text for all roles, excluding Designers.[/private]
\end{lstlisting}

With this shortcode, all users will read the private message, while Designers will be excluded. If you define an alternate message with \verb+alt+ option, Designers will read the alternate message only.

You can also exclude multiple roles. For example:

\begin{lstlisting}
[private role="custom" custom_role="designers, engineers, author" reverse=1 alt="You can't read hidden texts because you are part of Designers and/or Engineers and/or Author roles"]Text for all roles, excluding Designers, Engineers, and Author roles.[/private]
\end{lstlisting}

Take note that Administrators will read the hidden text, even if the current Administrator has also one or more of the excluded roles. See the next paragraph for more information and also the \ref{table:roles}.

\subsection{The Administrator role}

The Administrator role is a special role in this plugin. This role can always read the hidden texts, unless one of these options has been used:

\begin{itemize}
 \item a \verb+{role}-only+ option (excluding \verb+visitor+ and \verb+visitor-only+);
 \item a \verb+none+ (with \verb+recipient+) option;
 \item a \verb+custom-only+ option.
\end{itemize}

For example, let's say that the role Designers has been excluded from reading a hidden text. If an Administrator is reading that page and he has also the Designers role, he will read the hidden text. In the following example, Administrator (which has the Designer role too) can read the hidden text:

\begin{lstlisting}
[private role="custom" custom_role="designers" reverse=1]Text for all roles, excluding Designers role.[/private]
\end{lstlisting}

In the following examples, instead, Administrators cannot read the hidden texts:

\begin{lstlisting}
[private role="author-only"]Private note for Author.[/private]
\end{lstlisting}

\begin{lstlisting}
[private role="none" recipient="john"]Private note for John.[/private]
\end{lstlisting}

\begin{lstlisting}
[private role="custom-only" custom_role="engineers"]Private note for Engineers role.[/private]
\end{lstlisting}

\subsection{[align] Align style}

Accepted arguments:

\begin{itemize}
 \item \verb+left+ - Left align the paragraph
 \item \verb+center+ - Center align the paragraph
 \item \verb+right+ - Right align the paragraph
 \item \verb+justify+ - Justify the paragraph
\end{itemize}

\subsection{[alt] Alternate text for excluded users}

If you want to show an alternate text in case the reader can't read, you can use:

\begin{lstlisting}
[private role="author" alt="You have not rights to read this."]Text for authors only[/private]
\end{lstlisting}

Please, take note that the alternate text, if defined, is always publicly displayed.

The alternate text can contain some \textsc{html} tags. The list is:

\begin{itemize}
 \item \verb+b+ or \verb+strong+ for bold text;
 \item \verb+em+ or \verb+i+ for italic text;
 \item \verb+a+ for links, with \verb+href+ and \verb+title+ included. For \verb+href+ and \verb+title+ do not use double quote, but single quote.
\end{itemize}

For example:

\begin{lstlisting}
[private role="subscriber" alt="<a href='https://www.example.com/subscribe' title='Subscribe now!'>Subscribe</a> to read this <strong>super powered</strong> text!"]Hidden text.[/private]
\end{lstlisting}

\subsection{[container] The \textsc{html} container for the text}

Starting from version 2.4, the user can choose the \textsc{html} container element for the text.

Accepted arguments:

\begin{itemize}
 \item \verb+p+ - The default value;
 \item \verb+div+ - This element allows you use \textsc{html} elements like lists, headings, and more.
 \item \verb+span+ - This element allows you to add private content inline.
\end{itemize}

Examples:

Wrap the note inside a \textsc{div}:

\begin{lstlisting}
[private container="div"]This is the text[/private]
\end{lstlisting}

Wrap the note inside a \textsc{span}:

\begin{lstlisting}
This is my home I bought a year ago [private container="span"](the key is under the doormat)[/private].
\end{lstlisting}


\subsection{[id] Adding custom \textsc{id}s for the \textsc{html} container}

The user of the plugin can add custom \textsc{id}s to the \textsc{html} container using the option \verb+id=name-of-the-id+, for example:

\begin{lstlisting}
[private id="myid1, custom-id-2, my_id_3"]Private text.[/private]
\end{lstlisting}

The single \textsc{is} names must be separated by a comma, not by a space. Also, if the \textsc{id} is composed by more words, the words must be separated by a dash or by an underscore, otherwise the words will be considered as separated \textsc{id} names.

\subsection{[class] Adding custom classes for the \textsc{html} container}

The user of the plugin can add custom classes to the \textsc{html} container using the option \verb+class=name-of-the-class+, for example:

\begin{lstlisting}
[private class="myclass1, custom-class-2, my_class_3"]Private text.[/private]
\end{lstlisting}

The single class names must be separated by a comma, not by a space. Also, if the class is composed by more words, the words must be separated by a dash or by an underscore, otherwise the words will be considered as separated class names.

\section{Giving a style to the text generated by Private Content}

The text generated by this plugin uses some CSS classes, listed here:

\begin{itemize}
 \item \verb+private+ - Applied to each \textsc{html} element generated by this plugin.
 \item \verb+{role}-content+ - Applied to the text for a particular role. Here is the complete list:
 \begin{itemize}
  \item \verb+administrator-content+
  \item \verb+editor-content+
  \item \verb+author-content+
  \item \verb+contributor-content+
  \item \verb+subscriber-content+
  \item \verb+visitor-content+
  \item \verb+user-content+ - When used for specific user(s).
  \begin{itemize}
   \item \verb+user-only+ - When used for specific user(s). This class is always preceded by \verb+user-content+ class.
    \item \verb+{user_login}-only+ - When used for specific user(s). The placeholder \verb+{user_login}+ will be changed into the actual login name. This class is always preceded by \verb+user-content+ and \verb+user-only+ classes.
    \item \verb+user-only-reverse+ - When the \verb+reverse+ option is used. This class is always preceded by \verb+user-content+ class.
  \end{itemize}
  \item \verb+{custom_role}-content+ - When used for custom roles. The placeholder \verb+{custom_role}+ will be changed into the actual custom role.
  \end{itemize}
 \item \verb+{role}-only+ - Applied to the text for a specific role. This class is always preceded by \verb+{role}-content+ class.
 \item \verb+{custom-id-names}+ - Added when specified by the user.
 \item \verb+{custom-class-names}+ - Added when specified by the user.
 \item \verb+alt-text+ - Applied to the alternate text.
\end{itemize}

\section{Capabilities created by Private Content plugin}

These are the capabilities created by this plugin:

\begin{itemize}
 \item \verb+read_ubn_editor_notes+
 \item \verb+read_ubn_author_notes+
 \item \verb+read_ubn_contributor_notes+
 \item \verb+read_ubn_subscriber_notes+
\end{itemize}

These capabilities will be removed when the plugin is uninstalled using the usual uninstallation command in the WordPress Dashboard.

\section{Available filters}

\begin{itemize}
 \item \verb+ubn_private_align_style+ - Filters the style string. An example of a string is:
\end{itemize}

\begin{lstlisting}
$align_style = ' style="text-align: justify;"';
\end{lstlisting}

Please note the leading space before \verb+style=+.

\begin{itemize}
 \item \verb+ubn_private_containers+ - Filters the array containing the \textsc{html} container for the private and alternate text.
\end{itemize}

An example is:

\begin{lstlisting}
$containers = array(
  'open'  => '<p',
  'close' => '</p>',
);
\end{lstlisting}

Notice that the first element of the array must not have the closing \verb+>+.

\begin{itemize}
 \item \verb+ubn_private_content+ - Filters the private content.
 \item \verb+ubn_private_alt+ - Filters the alternate content.
 \item \verb+ubn_private_text+ - Filters the entire private and alternate text, just before the output. The string contains also the HTML container.
 \item \verb+ubn_private_text_empty+ - Filters the text if it is empty, just before the output.
 \item \verb+ubn_private_class_selector+ - Filters the \textsc{html} output for the classes.
 \item \verb+ubn_private_id_selector+ - Filters the \textsc{html} output for the \textsc{id}s.
\end{itemize}

\section{Testing the shortcode}

It could be useful to test if the shortcode is working as intended. To do this, you can use a plugin that lets you temporarily switch between accounts. The plugin is \href{https://wordpress.org/plugins/user-switching}{User Switching}\footnote{\texttt{https://wordpress.org/plugins/user-switching}.}.

\end{document}
